(function(){"use strict";function s(n){var r=3;return t===0&&(r=4),$.ajax({url:"https://show-g.mediav.com/s?type=1&of=4&newf=1&scheme=https",data:{showid:n+"",uid:e.api.mv_uid,mid:e.api.GetMID(),impct:r,reqtimes:++t},dataType:"jsonp",jsonp:"jsonp",timeout:3e4})}function o(){var n=6;return t===1&&(n=7),$.ajax({url:r,data:{u:e.api.GetMID(),n:n,c:"economy",sign:"360_3f94cbf1",f:"jsonp",net:"5",device:"2",v:"1",sqid:"",scene:"1",stype:"portal",version:"",ufrom:"1",sub_scene:""},dataType:"jsonp",jsonp:"callback",timeout:3e4})}function a(){$.when(s("e91HM9"),o()).done(function(r,i){var s=h(i[0]),o=p(r[0]),a=[],c=[],d=[];t===1&&o.length!==0&&(c=s.splice(0,1),d=o.splice(0,1),c=c.concat(d));if(o.length!==0){var v=0,m=s.length;while(v<m){var g=o.splice(0,1)[0],y=s.splice(0,2);a=a.concat(y),y.length===2&&g!==undefined&&a.push(g),v++}}else a=s;c.length!==0&&(a=c.concat(a));var b=0,w=a.length,E=[];if(t>1){var S=e.cookie.get("_len");n=Number(S)+Number(n)}e.cookie.set("_len",w,new Date((new Date).Format("yyyy/MM/dd 23:59:59")));while(b<w){var x=a[b],T="";x.id="content"+(b+n),u.push(x.id);switch(x.tplType){case"ads1":T="ads_1";break;case"ads2":T="ads_2";break;case"ads3":T="ads_3";break;case"ads4":T="ads_4";break;case"news0":T="news_0";break;case"news1":T="news_1";break;case"news3":T="news_3";break;default:}if(T!==""){var N=$("#"+T).html(),C=doT.template(N);E.push(C(a[b]))}b++}$("#tools-right-flow").append(E.join("")),e.cookie.set("id_total",u,new Date((new Date).Format("yyyy/MM/dd 23:59:59"))),f(),l(u)})}function f(t){var n=e.cookie.get("id_total").split(","),r=$(".right-info-flow").height(),s=$(".right-info-flow").offset().top,o="innerHeight"in window?window.innerHeight:document.documentElement.clientHeight,u=n.length,a=0,f,l=$(".right-info-flow")[0].getBoundingClientRect();i=$(window).scrollTop(),f=o+i-s,f>r&&(f=r);for(;a<u;a++){var c=$($("#tools-right-flow").children()[a]).attr("id");if(c=="")continue;var h=$("#"+n[a]),p=h[0].getBoundingClientRect(),d=h.data("source"),v=0,m=.2,g=p.bottom-p.top;v=g*m;if(d==="ads"&&p.top-l.top+v<f&&n[a]!==""){var y,b,w,E=h.find(".ads2-hd").html();if(E===undefined){var S=h.find(".news-link");y=S.data("imptk"),b=S.data("tpl")}else{var x=h.find(".ads2-hd").children("a");y=x.data("imptk"),b=x.data("tpl")}h.attr("id",""),e.Stat.setLog(y),e.Stat.send("867.2387.gif")}if(d==="jrbd"){var T;p.top-l.top+v<f&&(T=setTimeout(function(t){return function(){var r=$($("#tools-right-flow").children()[t]).attr("id");if(r=="")return;var i=$("#"+n[t]),s=i[0].getBoundingClientRect(),o=s.bottom-s.top;if(l.top-s.top>o)return;i.attr("id","");var u=i.find(".news-link"),a=u.data("gnid"),f=u.data("a"),c=u.data("c"),h=decodeURIComponent(u.data("source_default")),p=u.data("s"),d=u.data("style"),v=u.data("sid"),m=[];m.push([a||"",f,c,h,p,d,"2000",v||""]);var g={uid:e.api.GetMID(),sign:"360_3f94cbf1",device:"2",net:"5",stype:"portal",t:(new Date).getTime(),channel:"economy",sqid:"",act:"real_show",func:"pc_news_realshow",scene:"1",sub_scene:"",n:"1"},y="";g.url_pack=encodeURIComponent(JSON.stringify(m));for(var b in g)y+="&"+b+"="+g[b];y="?"+y.substring(1),e.Stat.setLog("https://news.qhstatic.com/srv/c2",y),e.Stat.send("867.4634.gif")}}(a),2e3))}}}function l(){var t=$("#tools-right-flow");t.off().on("click",".news-link",function(t){t.stopPropagation();var n=$(this),r=n.data("source");if(r==="ads"){var i=n.data("clktk"),s=n.data("tpl"),o=e.getOffset(n.get(0),t.clientX,t.clientY);e.Stat.setLog(c(i,o)),n.attr("href",c(n.data("href"),o)),e.Stat.send("867.4462.gif")}else{var u={uid:e.api.GetMID(),sqid:"",url:n.data("u"),sign:"360_3f94cbf1",stype:"portal",device:"2",net:"5",scene:"1",sub_scene:"",t:(new Date).getTime(),channel:"economy",sid:n.data("sid"),a:n.data("a"),c:n.data("c"),act:"click",source:n.data("source_default"),s:n.data("s"),style:n.data("style")},a="";for(var f in u)a+="&"+f+"="+u[f];a="?"+a.substring(1),e.Stat.setLog("https://papi.look.360.cn/srv/c",a),e.Stat.send("867.3311.gif")}})}function c(e,t){return e=e.replace("__EVENT_TIME_START__",window._timestamp_mousedown),e=e.replace("__EVENT_TIME_END__",window._timestamp_mouseup),e=e.replace("__OFFSET_X__",t.x),e=e.replace("__OFFSET_Y__",t.y),e=e.replace("__CPX__",t.x),e=e.replace("__CPY__",t.y),e}function h(t){var n=[],r={},i=[],s=0,n=t.data.res||[];s=n.length;for(var o=0;o<s;o++){var u=n[o],a=[],f={exp_ids:r.exp_ids,request_id:r.request_id,doc_id:u.doc_id},l={};u.ext=u.ext||{},l.images=u.i.split("|")||[],l.title=u.t||"",l.url=u.pcurl||"javascript:void(0);",l.url_encode=l.url,l.source=u.f||"",l.u=encodeURIComponent(u.u)||"",l.c=u.c,l.a=u.a,l.source_default=encodeURIComponent(u.source),l.s=u.s,l.style=u.style,l.sid=t.sid,l.gnid=u.gnid,l.showtime=u.showtime,l.time=u.p?(new Date(u.p*1e3)).Format("MM-dd hh:mm"):"",l.newsType=u.feed_from||"jrbd",l.images.length>=4?(l.tplType="news3",l.images.splice(4)):l.images.length==3?(l.tplType="news3",l.moreImg=!0):l.images.length>=1&&l.images[0]!=""?(l.tplType="news1",l.images.splice(1)):(l.tplType="news0",l.images=[]),u.channel=="video"&&u.ext.video&&u.ext.video.timelong&&(l.isVideo=!0,l.duration=u.ext.video.timelong),l.images.forEach(function(t,n){l.isVideo?l.images[n]=e.api.cutImg(t,"320_180_"):l.images[n]=e.api.setImgUrl(t,"320_180_")}),i.push(l)}return i}function p(e){var t=e.impurl,n=e.ads||[],r=0,i=[];while(r<n.length){var s=n[r],o={};s.type==4&&s.video?(o.tplType="ads4",o.video=s.video):s.type==2&&s.assets&&s.assets.length?(o.assets=s.assets.slice(0,4),s.imgw!=0&&(s.assets[0].imgw&&s.assets[0].imgw==s.assets[0].imgh||s.imgw==s.imgh)&&(o.imgType="square"),o.tplType="ads2"):s.type==3?o.tplType="ads3":o.tplType="ads1",o.img=s.img.split("|")[0],o.newsType="ads",o.adsTag=!0,o.title=s.title||"",o.source=s.src,o.url=s.curl,o.url_encode=o.url,o.desc=s.desc,o.imptk=s.imptk.join(","),o.clktk=s.clktk,o.imparg=s.imparg||"",o.clstk=s.clstk&&s.clstk||"",i.push(o),r+=1}return i}function v(){var e=$("#tools-right-flow").height(),t=$(".right-info-flow").scrollTop(),n=(e-d-t)/d;n<.01&&a()}function m(e,t,n){var r,i=(new Date).getTime();return function(){var s=this,o=arguments,u=(new Date).getTime();clearTimeout(r),u-i>=n?(e.apply(s,o),i=u):r=setTimeout(function(){e.apply(s,o)},t)}}function g(){a(),$(".right-info-flow").on("scroll",m(v,500,1e3)),$(".right-info-flow").on("scroll",f),$(window).on("scroll",f),Array.prototype.forEach||(Array.prototype.forEach=function(t,n){var r,i;if(this==null)throw new TypeError("this is null or not defined");var s=Object(this),o=s.length>>>0;if(typeof t!="function")throw new TypeError(t+" is not a function");arguments.length>1&&(r=n),i=0;while(i<o){var u;i in s&&(u=s[i],t.call(r,u,i,s)),i++}})}var e={},t=0,n=0,r="https://papi.look.360.cn/mlist",i;e.api={GetSID:function(){if(e.api.sid)return e.api.sid;try{return e.api.sid=external.GetSID(window),e.api.sid}catch(t){return""}},GetMID:function(){return e.api.mid?e.api.mid:(e.api.mid=e.api.GetSID()&&external.GetMID(e.api.sid),e.api.mid===""&&e.cookie.get("util-api-mid")===""?e.api.mid=$.md5(e.api.mv_uid):e.api.mid===""&&(e.api.mid=e.cookie.get("util-api-mid")),e.cookie.set("util-api-mid",e.api.mid,new Date((new Date).Format("yyyy/MM/dd 23:59:59"))),e.api.mid)},setImgUrl:function(e,t){e=e||"",t=t||"";var n=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/,r=/^[0-9_]+$/,i=e.match(n)||[],s=i[5]&&i[5].split("/"),o=s&&s[1]||"";return r.test(o)?e.replace(o,t):e},cutImg:function(e,t,n){t=t||"160_90_",n=n||"video";var r=n+"/"+t;return e?e.replace(/(p\d*)\.(ssl\.)?(qhimg(s4)?)\.com\/(\w{2,}\/\d*_\d*_\d*\/)*/ig,"$1.$2$3.com/"+r+"/"):""},mv_uid:function(){function e(e){var t=1,n=0,r;if(e){t=0;for(r=e.length-1;r>=0;r--)n=e.charCodeAt(r),t=(t<<6&268435455)+n+(n<<14),n=t&266338304,t=n!=0?t^n>>21:t}return t}return(""+e(window.location.href)+e(document.domain)+(new Date-0)+Math.floor(Math.random()*1e3)).substr(0,32)}()},e.Stat={init:function(){},send:function(t,n){var r=[];if(Object.prototype.toString.call(t)=="[object String]")r.push(t);else{if(Object.prototype.toString.call(t)!="[object Array]")return;r=t}for(var i=0;i<r.length;i++){var s=r[i],o="";if(n&&typeof n=="object")for(var u in n)o+=u+"="+n[u]+"&";(new Image).src="https://dd.browser.360.cn/static/a/"+s+"?"+o+"mid="+e.api.GetMID()+"&"+Date.now()+Math.random().toString().replace("0.","").substr(0,10)}},setLog:function(e,t){if(!e)return;var n=e.split(","),r=Math.random().toString().replace("0.","").substr(0,10);for(var i=0;i<n.length;i++){var s="";t!==undefined&&(s=t),(new Image).src=n[i]+s}}},e.cookie={get:function(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=$.trim(n[r]);if(i.indexOf(t)==0)return i.substring(t.length,i.length)}return""},set:function(e,t,n){var r="expires="+n.toGMTString();document.cookie=e+"="+t+"; "+r}},e.getOffset=function(e,t,n){var r=e.getBoundingClientRect(),i=parseInt(t-r.left),s=parseInt(n-r.top),o={x:i,y:s};return o};var u=[],d=$(".right-info-flow").height();g()})();